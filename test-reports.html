<!DOCTYPE html>
<html>
<head>
    <title>Test Reportes Avanzados</title>
</head>
<body>
    <h1>Test de Endpoints de Reportes Avanzados</h1>
    <div id="results"></div>
    
    <script>
        const BASE_URL = 'http://localhost:3000/api';
        const resultsDiv = document.getElementById('results');

        async function testEndpoints() {
            try {
                resultsDiv.innerHTML += '<p>üîê Haciendo login...</p>';
                
                // Login
                const loginResponse = await fetch(`${BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'admin@bellezapp.com',
                        password: 'admin123'
                    })
                });

                const loginResult = await loginResponse.json();
                
                if (!loginResult.token) {
                    resultsDiv.innerHTML += `<p>‚ùå Error en login: ${JSON.stringify(loginResult)}</p>`;
                    return;
                }

                resultsDiv.innerHTML += '<p>‚úÖ Login exitoso</p>';
                const token = loginResult.token;
                const headers = {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                };

                // Test rotaci√≥n de inventario
                resultsDiv.innerHTML += '<p>üìä Probando an√°lisis de rotaci√≥n de inventario...</p>';
                try {
                    const rotationResponse = await fetch(`${BASE_URL}/financial/analysis/inventory-rotation?storeId=690108925f4e5f352cb561d7&startDate=2025-11-01&endDate=2025-11-30`, {
                        headers
                    });

                    if (rotationResponse.ok) {
                        const rotationData = await rotationResponse.json();
                        resultsDiv.innerHTML += `<p>‚úÖ An√°lisis de rotaci√≥n: <pre>${JSON.stringify(rotationData, null, 2)}</pre></p>`;
                    } else {
                        const errorText = await rotationResponse.text();
                        resultsDiv.innerHTML += `<p>‚ùå Error en rotaci√≥n: ${rotationResponse.status} - ${errorText}</p>`;
                    }
                } catch (e) {
                    resultsDiv.innerHTML += `<p>‚ùå Error en rotaci√≥n: ${e.message}</p>`;
                }

                // Test rentabilidad
                resultsDiv.innerHTML += '<p>üí∞ Probando an√°lisis de rentabilidad...</p>';
                try {
                    const profitabilityResponse = await fetch(`${BASE_URL}/financial/analysis/profitability?storeId=690108925f4e5f352cb561d7&startDate=2025-11-01&endDate=2025-11-30`, {
                        headers
                    });

                    if (profitabilityResponse.ok) {
                        const profitabilityData = await profitabilityResponse.json();
                        resultsDiv.innerHTML += `<p>‚úÖ An√°lisis de rentabilidad: <pre>${JSON.stringify(profitabilityData, null, 2)}</pre></p>`;
                    } else {
                        const errorText = await profitabilityResponse.text();
                        resultsDiv.innerHTML += `<p>‚ùå Error en rentabilidad: ${profitabilityResponse.status} - ${errorText}</p>`;
                    }
                } catch (e) {
                    resultsDiv.innerHTML += `<p>‚ùå Error en rentabilidad: ${e.message}</p>`;
                }

                // Test tendencias
                resultsDiv.innerHTML += '<p>üìà Probando an√°lisis de tendencias...</p>';
                try {
                    const trendsResponse = await fetch(`${BASE_URL}/financial/analysis/sales-trends?storeId=690108925f4e5f352cb561d7&period=daily&startDate=2025-11-01&endDate=2025-11-30`, {
                        headers
                    });

                    if (trendsResponse.ok) {
                        const trendsData = await trendsResponse.json();
                        resultsDiv.innerHTML += `<p>‚úÖ An√°lisis de tendencias: <pre>${JSON.stringify(trendsData, null, 2)}</pre></p>`;
                    } else {
                        const errorText = await trendsResponse.text();
                        resultsDiv.innerHTML += `<p>‚ùå Error en tendencias: ${trendsResponse.status} - ${errorText}</p>`;
                    }
                } catch (e) {
                    resultsDiv.innerHTML += `<p>‚ùå Error en tendencias: ${e.message}</p>`;
                }

                // Test comparaci√≥n de per√≠odos
                resultsDiv.innerHTML += '<p>üîÑ Probando comparaci√≥n de per√≠odos...</p>';
                try {
                    const comparisonResponse = await fetch(`${BASE_URL}/financial/analysis/periods-comparison?storeId=690108925f4e5f352cb561d7&currentStartDate=2025-11-01&currentEndDate=2025-11-15&previousStartDate=2025-10-01&previousEndDate=2025-10-15`, {
                        headers
                    });

                    if (comparisonResponse.ok) {
                        const comparisonData = await comparisonResponse.json();
                        resultsDiv.innerHTML += `<p>‚úÖ Comparaci√≥n de per√≠odos: <pre>${JSON.stringify(comparisonData, null, 2)}</pre></p>`;
                    } else {
                        const errorText = await comparisonResponse.text();
                        resultsDiv.innerHTML += `<p>‚ùå Error en comparaci√≥n: ${comparisonResponse.status} - ${errorText}</p>`;
                    }
                } catch (e) {
                    resultsDiv.innerHTML += `<p>‚ùå Error en comparaci√≥n: ${e.message}</p>`;
                }

                resultsDiv.innerHTML += '<p>üéâ Pruebas completadas!</p>';

            } catch (error) {
                resultsDiv.innerHTML += `<p>üí• Error general: ${error.message}</p>`;
            }
        }

        // Ejecutar cuando la p√°gina se carga
        window.onload = testEndpoints;
    </script>
</body>
</html>